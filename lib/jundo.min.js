(function(e){function t(){this.undoStack=[],this.redoStack=[]}t.instances=[],t.get=function(e){if(!e)throw new Error("A valid context must be provided");for(var n=0;n<t.instances.length;n++)if(t.instances[n][0]===e)return t.instances[n][1];var r=new t;return t.instances.push([e,r]),r},t.remove=function(e){if(!e)throw new Error("A valid context must be provided");for(var n=0;n<t.instances.length;n++)if(t.instances[n][0]===e){t.instances.splice(n,1);return}throw new Error("No JUndo instance is associated with the provided context")},t.clear=function(){t.instances=[]},t.prototype={register:function(e,t){return this.undoStack.push({u:e,r:t}),this.redoStack=[],this.trigger("change","register",this.undoCount(),this.redoCount()),this},undo:function(){if(this.undoStack.length===0)throw new Error("Undo stack is empty");var e=this.undoStack.pop();return this.redoStack.push(e),e.u(),this.trigger("change","undo",this.undoCount(),this.redoCount()),this},redo:function(){if(this.redoStack.length===0)throw new Error("Redo stack is empty");var e=this.redoStack.pop();return this.undoStack.push(e),e.r(),this.trigger("change","redo",this.undoCount(),this.redoCount()),this},clear:function(){this.undoStack=[],this.redoStack=[],this.trigger("change","clear",0,0)},undoCount:function(){return this.undoStack.length},redoCount:function(){return this.redoStack.length}},e(t.prototype),typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=t),exports.JUndo=t):this.JUndo=t}).call(this,this.Eventify||require&&require("Eventify"));